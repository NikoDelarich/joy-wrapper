
function loadAsync() {
  var allimages= document.getElementsByTagName('img');
  var idx=0;
  for (var i=0; i<allimages.length; i++) {
    if (allimages[i].getAttribute('data-src')) {
      var img = allimages[i];
      // setTimeout($.proxy(function() {
        img.setAttribute('src', img.getAttribute('data-src'));
      // }, img), idx*30);
      idx++;
    }
  }
}

function downloadPicture() {
  var styleUrl = $(".image")[0].style.backgroundImage;
  var url = styleUrl.substring(styleUrl.indexOf("\"") + 1, styleUrl.lastIndexOf("\""));
  var name = url.substring(url.lastIndexOf("/") + 1);
  
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200){
      var blob = new Blob(
        [this.response],
        {type: "image/jpeg"}
      );
      saveAs(blob, name);
    }
  }
  xhr.open('GET', url);
  xhr.responseType = 'blob';
  xhr.send();      
}

(function(data) {
  
  var pw = localStorage.getItem("cn_gallery_pw");
  if(pw) {
    try {
      JSON.parse(decrypt(data, pw, 1));
    } catch(e) { pw = null; }
  }
  if(pw === null) {
    pw = prompt("Bitte gib das Passwort ein! Wenn du das Passwort nicht weiÃŸt, frag beim Brautpaar nach ;-)");
  }
  var decryptedData = null;
  try {
    decryptedData = JSON.parse(decrypt(data, pw, 1));
    if(decryptedData) {
      localStorage.setItem("cn_gallery_pw", pw);
    }
    console.log("Success");
  } catch(e) {
    alert("Passwort falsch! Du hast \"" + pw + "\" eingegeben!");
    location=location.href;
    return;
  }
  
  $("#zipLink").attr("href", decryptedData.zipUrl);
  
  var articles = [];
  decryptedData.fileNames.forEach(function(obj) {
    /* Override URL */
    decryptedData.fileUrl = "https://f001.backblazeb2.com";
    var url = decryptedData.fileUrl + decryptedData.basePath + obj;
    articles.push(""+
      "<article>" +
        "<a class='thumbnail' href='" + url + "' data-position='left center'><img src='/gallery/images/thumbs/01.jpg' data-src='" + url.replace("photobooth/", "photobooth/thumbs/") + "' /></a>" +
      "</article>" +
    "");
  });
  
  $("#thumbnails").html(articles.join(""));
  
  window.addEventListener('load', loadAsync, false);
})("55daf8321c288d05e0855badef2b8898ef66f3a55412b4593cfde44bf7011c4f723205d5624e427d1c5b306d9fcb8c63b579f52d07155795af6080b2d268e0498a452ed7b74c08d7fc78760fcc298f05ca945374d343e1c667be0d6a689b6bcd2f0ce9cdca06a49b726f7f9e7f33e007b7ab6c57e9f81d8a1c9686f8282d3e6e23fdd9a7bc1e5caf3e0354b5f8221de5b4fe9e91d9bc17841d6660bbb8c03b5dc62b0fba6276593a11915320609cecad255656c9c500ca8a453f892202eb8e448e8940d83b5eba181d9be85f835bafe0e5935e44fc3c326f446fb52319a3f8eff924898c5a5ac5fb5ae5c5c8b1a5cc8e5ffe89c197d79c78a1ab7e2dc4442da5381aa65f0c9942d2d920559cd9d3babd7a1a54ef42fb85237327d8c8c87e44daa8fad7856db3c59f421fbf1b2871e356879372180e14364f92eb8efdfe3d6dbd537b4d76f316e44576287d8fc6eac1aa8845559aafc64dbf08c0ccabc8ff0619c8dace2e25de3a6c3e61ccb567b2bf5f7b9f2b518a9569a717cccb47389d6c78b27b2bdc50ab51b52d07fa744ea1c215e443f7c7c5b9140bec712dc6c3c89ddbd902c37cb586b2350dc4b510756fc50789079d865a846cc189524e37f5c9a9f61f011eba85000b6122b47fcab461625e65b1ab73370c72c0d050c195b9785cea6ed4ef6d154babce75f2462dd3b5e2b7682b9325176364a981f7e4ebb01799400e8fbdcb6c45fca4fa9c222e573a2e73b790ccbf14291982cb89093780395552e9c27b4ae101dab8fb1e11dc3ec94d7a05710a28024b641e32aa58f9544f6994c0e5edd863f29f8777855ef1a7429ff32f1f5840849cf02b016f314eb5d291d8650d11f6f350143fcaeacbd3746f7f1a437bd3b88b984d3caa52f74a5c2eb17579506b2e41e30a89df05b8bbb636c06f863d62ed355b029fc1c65ced9d256cca835b95bf5e7bf78ee9bdad2ae346e86c3bc56d42db93bf77941d9ecefc0cf341c41cc2a598e14acf9df54b7d559d61788ef054827e44d9d6cd020f1e509544d6042dd875438a7cfc60ec0efb3d6d3b3abd53492960442f0d59b7ca6a890be2618811b7e24ce8cae0cee7b5f353126ff266a616e37c72451125e3f235c7833b80b15992a88e4bdba63e293cc1f3d745c5c5187c23ab8a33d15b363b41510cd384fc6d09a76bc99811bca894ccb52e928e13632778b2559dc40b9161e604f24268cce9be1dc18dffe262a0ddd0fdcb082e2395b252ea75f5c05dc50d17b1771612a56b030e954587d872078493c5aa7156737c14b74005966239f312d872b6fd38eeb48f985ce304d59a8bf9f156d6c9ba00ca3c3d360dc95e3532713c1ad5972e2c8587622dcb7b592bb9c67726c8bf1d3cfb95688a9b1d94e2995813daa768e57cdc2fa37a7dc85fd81d5eac5c1db682946e9308be3623bfd4534527136ee446a951a363b6c27b2a939e6fd4f6155f604c353172b64e524177e003f9df537ed19070fdd8b7c680ec0bc39f1cfeb0fab48c798c0311f3e54417cf06f49754a8fe29cf31401e5038b429a83c5a055cb30d64030d5a53f011c66ff482b11563a3ea92d5ebd64907975528fa35e2e9582a758d402170b211b8270da68ad36e1e40130aa4b7a789284cb9756c75e041823a4dbf0e50df9d8c0695bb115b404f4d9f549cbcf73dcacb478b3b6f4c78cbf101730ee2a37678cdae873d37b4872183b9c338bbb571d3d205a4a226c08881d790a8bb0ed5887fbf2e193ea6710df2685b76223f197cc07ab3d3bbefe543bde788c29878ce3dd73668ad3349720924bad6005c055b87c0649673c4472845b7eab663ceb1c94dd530cd0f40e0c725c2610afa6533f7b5d71a16c74b0a980b56015518aaf5c2f4f9b00690abbb435625d20a7ffa8885a1a7a2ca42ad618e7d77380a5d1c37d6ecc58a733ceaceffb7bfc7db867e659e65c6a793373ae735f96042c78c507c2ccfb0b228e73334803e978931ede4042595a6a3f9d8cae30ba1b9b3a66b905bb4b1852ba2d2ff11a526e54aff1728a46fa3fa22c948fc637c04765d119e8cf7ff44b84409dcc1a37fee6ffb25413f032ca884ee0d991a20bb05c1ebeaf0e6e040d236015542b940042515d0ee2990412f5c6860e39eb5dadf06f271c0f371b9463855a3528bdda95635a5a0b9908e77852ed656eab8e17a345df7d196a9ee90c906b24a34ba4922b85b793e8c27a7f076a72d5175cb7903b52656593aa756e46c83f7597315f0c910e14e8dcc4f98194ad0030443bced7c723d0c3c5f1485294c878b6ad3ab3aea00bc3199a75125c1a0d0295d090a95d5abf8155c85c85485e2b7e602bde1335b1eddc1cc455407e5bd41f4c130b74d5fd4cace38906339a80ff4d72983620f413411c24aa6b242f614d80eb8d4002ab753031f9b74757a9be9de380952fd38d31a2d7acedfd8f177b0dfead99a6fe04bbee35473fe002c2f94a032e6e22094494138ecc37ef1b8ba4153aea33e454d495c85647074722c4a1f70c6d74fe107f50a14f3b505553e988fe0faa5847416d4c50c95e0b61ca6322c14355b357705bbcb19fb3fcbf9ae05f17f20188df4f173d476251b393297847de7da0f15f488ac882cb0b02e162733fe962f639b95aa75afa0b20925ae6272a377af475691948d20c40fc82f3d9f38d86ebc1edab98e8b73e82184fbcc9b5c33b0309ac3f1f5080c6abbfaabfc9e18a5453bf8dcce1c3fd145177c983fa65fbdd7d679174af37b8a566bd346c9b2aab7a3c792218d7001df2b10c849af2dc59e3f9974c5d52df66c3380fff80a9d1e3922b71b5da652914a44d37021a452e02faf1ceebf40d974588a947637f3e137a456e927b5e1d4807baf9854c4cd95f689c9ebdd2d1bf6661728c3319f1ad184e859d1709ee0c469d709c0a6132e03d48e1096c2069c66466d762b638b249a5b43693a510eeed5ea91726ac83e2bea930ea4a752ff8a6655a179af10b20bcc55cd9807bbd386953aa87897e2ee57461d00013dc900c18dd4a7816a362e68582b990e279600eeb4370fd7a9a9681849fc75475a575cd8ac56ba3aaa2fee6946f6aaec30a8a43d41730aee1251b90adc292faa71b15b2eb004b7a8c97d1694e4457e164b7dfb16acbb2fe31c51328c28ac865b2e22a429dd7268910754ec3b560d0698a9b217381a43d0dbd213ce524254e26df712a2ce51cafa06f4dc3e139210b8ec8433fd6ef97f3c7969019a45f512c9e1ff4c172ff73b810dd3b4733d47d5cefcb6018a12175e6224f25e7da2643bec3fdafeffd816aaa33f14210bc7746140ed1915e442f2bdef7998b9b7c9d1a466f9fd2c15459020db3b5c7bf879a594c030f1a2a38f87cd4dff60bd4d2ea9ec7673f9f44394a73bc16dc3899393cf52a8988416fd54d97bbae84b3857ef5f6a20bd6e08ac804f72265c46c31ce19790b3908561f1b5aa7e88e82a72ca5b8c8b6eb412c46580a50c4c60781e8add9d7fbf181bb511481a0c05fb5f53e271f4ceb1ac6ee05bfe4b69463b841879138502d706f3d0d95605fe96af4f55a7a954f39fcd184426c528c71863f9ac060750518cffdf710a40b5115f4134a038d4769079efd4cb95fe091474c6ede8b31022d6647b78be45ac59637a20e79be5c9db8531bcd0c8620197d6cc740283b778703025ec59bac1e3abc00fbb17418dbb94bc04b7266f13ad04920125a9d04e69cdfdd1845725260e3a1bf8ccdaa97ca57059380e79cbfea4438962454725bebec1f2b544388964be523b02d551efb581f7162a3a6bf448c344a811fb77bf73fcd1f50718463ddbe95dc7c2fd28daa9e5aae7d0ca5a250020b6d4568fcd19573252de2615c96f4c43726dc2b7a6e024d82b6a19de0a977af47117964248b274da7f6ad17f514170e7eac405f584235300bfadd483af270fb2251b4c48ecfe4d157dca6e3587197aa1dccda3915706b8");
